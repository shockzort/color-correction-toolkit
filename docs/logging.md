# Логирование

Ниже представлены требования к логированию в проекте.

## Общие требования логированию

Для структурированного логирования в приложениях должен быть разработан модуль.
Модуль предоставляет интерфейса логера, имплементацию, а также принятые уровни логирования.

Структурированный лог представляет собой совокупность текста сообщения и контекстных аргументов.

Использование структурированных логов упрощает отладку приложений и позволяет эффективно их собирать, индексировать и в последствии искать в системе сбора логов.

Структурированный лог представляет собой еще один слой абстракции, объектовую модель, которой оперирует код приложения.
Это позволяет абстрагировать код приложения от способа его представления.

В конечном итоге лог все равно будет представлен в некотором виде (JSON, текстовый key-value и т.д.), пригодном для передачи через транспорт (сеть, файл и т.д.), но для приложения эти детали имплементации должны быть скрыты.

Единственное требование, которое можно предъявить к аргументам логирования -- возможность сериализации в значение строкового типа.

Код приложения должен быть готов к работе со структурированными логами и при необходимости обогащать контекст логирования дополнительными аргументами.

Не следует заменять и дублировать ошибки в коде явным логированием, т.к. это создает ненужную избыточность. Зачастую, логирование должно быть сделано как можно ближе к точке входа.

Логирование следует, если это возможно, делать неинвазивным / неявным по отношению к коду приложения, путем создания логирующих оберток.

В целом, не запрещается делать логирование на нескольких слоях одного процесса, если это позволяет повысить наблюдаемость процесса.

В то же время логирование не является трейсингом. Логирование всегда ограничивается каким-то слоем приложения и, в отличие от трейсинга, не решает задачу связывания нескольких слоев единым контекстом (т.е. не распространяется "вглубь").
Это позволяет, при необходимости, настраивать логер для каждого слоя, определяя уровень логирования.

Текст сообщения лога должен начинаться со строчной буквы и не должен завершаться знаками препинания (т.е. требование аналогичное для сообщений ошибок).

### Уровни логирования

Уровни логирования модулей в общем соответствуют общепринятым и решают задачи уведомления о происходящих процессах в компонентах/слоях приложения.

Интерфейс логера предоставляет следующие методы:

* `Fatal` -- фатальная ошибка, которая должна приводить к немедленному завершению приложения (`os.Exit`).
Поскольку кроме уровня логирования этот метод обладает также поведенческой характеристикой, метод не следует использовать в тех местах, где код приложения должен завершаться корректно.
Правила хорошего тона -- не использовать этот метод.
В настоящий момент он существует только для обратной совместимости.

* `Panic` -- фатальная ошибка, которая должна приводить к панике.
Поскольку кроме уровня логирования этот метод обладает также поведенческой характеристикой, метод не следует использовать в тех местах, где код приложения должен завершаться корректно.
Правила хорошего тона -- не использовать этот метод.
В настоящий момент он существует только для обратной совместимости.

* `Error` -- критическая ошибка кода приложения. Если ошибка в некотором слое приложения вызвана ошибкой нижележащего слоя, эта ошибка должна быть включена в аргументы лога.
Например, на слое хранилища может случиться ошибка запроса к БД, которая будет проброшена выше в вызывающий код хэндлера. Если на уровне хэндлера производится логирование, то оно должно включать в себя полученную ошибку.

* `Warning` -- ожидаемая ошибка или нештатное поведение приложения. Так же как и `Error`, должен включать ошибку в аргументы лога, если таковая имеется.

* `Info` -- штатное поведение кода. Логирование с этим уровнем позволяет получить информацию о том, что некоторый процесс произошел, происходит или завершился успешно.
Например, входящий HTTP запрос и его успешное выполнение должно логироваться с `Info`.
Этот уровень логирования является минимально необходимым для работы приложения в реальном (production) окружении.

* `Debug` -- логирование с целью отладки. В лог могут включаться дополнительные, возможно, избыточные аргументы, которые позволяют произвести отладку кода.
Этот уровень не следует использовать в реальном окружении при штатной условиях работы приложений, во избежания создания излешней нагрузки на само приложение и систему логирования.

Все прочие возможные уровни логирования, используемых, например, в third party библиотеках, должны отображаться на вышеуказанные уровни.
